<div class="contenedor-software">
  <div class="lado-izquierdo">
    <h2 class="subtitulo">Búsqueda por Cliente</h2>

    <div class="barra-herramientas">
      <div class="grupo-busqueda">
        <input type="text" [(ngModel)]="textoBusqueda" (keydown.enter)="buscarCliente()"
          placeholder="Nombre del cliente..." class="input-busqueda" style="text-transform: uppercase;" />
        <button class="btn-buscar" (click)="buscarCliente()">Buscar</button>
      </div>

      <span class="contador-clientes">N° Registros: {{ datosFiltrados.length }}</span>

      <div class="dropdown-container" (clickOutside)="mostrarDropdown = false">
        <button class="btn-cambiar-archivo" (click)="toggleDropdown()">
          {{ hayArchivoCargado ? 'Cambiar archivo' : 'Elegir archivo' }}
          <nz-icon nzType="down" style="margin-left: 6px;"></nz-icon>
        </button>

        <div *ngIf="mostrarDropdown" class="dropdown-archivos">
          <div *ngIf="archivosSoftware.length === 0" class="opcion-dropdown">
            No hay archivos software
          </div>
          <div *ngFor="let archivo of archivosSoftware" class="opcion-dropdown" (click)="cambiarArchivo(archivo)">
            {{ archivo.nombreOriginal }}
            <nz-icon *ngIf="archivo.id === idArchivo" nzType="check"
              [ngStyle]="{ color: '#3b3b3b', float: 'right' }"></nz-icon>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <table class="tabla-hardware">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>¿Instalado?</th>
            <th>Nombre de software</th>
            <th>Fecha de instalación</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let fila of datosFiltrados" (click)="mostrarHistorialSoftware(fila)">
            <td [ngClass]="{ 'resaltado-desconocido-tabla': obtenerValorSeguro(fila.cliente) === 'Desconocido' }">
              {{ obtenerValorSeguro(fila.cliente) }}
            </td>
            <td [ngClass]="{ 'resaltado-desconocido-tabla': obtenerValorSeguro(fila.instalado) === 'Desconocido' }">
              {{ obtenerValorSeguro(fila.instalado) }}
            </td>
            <td [ngClass]="{ 'resaltado-desconocido-tabla': obtenerValorSeguro(fila.nombre) === 'Desconocido' }">
              {{ obtenerValorSeguro(fila.nombre) }}
            </td>
            <td [ngClass]="{ 'resaltado-desconocido-tabla': obtenerValorSeguro(fila.fecha) === 'Desconocido' }">
              {{ obtenerValorSeguro(fila.fecha) }}
            </td>
          </tr>
          
        </tbody>
      </table>
    </div>
  </div>


  <div class="lado-derecho">
    <!-- Card superior: Historial de versiones -->
    <div class="contenedor-detalles">
      <div class="card-detalle">
        <h3 class="titulo-card">Historial de versiones software seleccionado</h3>
        <div class="lista-versiones">
          <div class="fila-cabecera">
            <span>Software</span>
            <span>Versión</span>
            <span>Fecha instalación</span>
          </div>
          <div
            *ngFor="let version of historialVersiones"
            class="fila-version"
            [class.ultima-version]="version.fecha === ultimaFechaVersion"
          >
            <span>{{ version.nombre }}</span>
            <span>{{ version.version || 'Desconocido' }}</span>
            <span>{{ version.fecha || 'Desconocido' }}</span>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Card inferior: gráfico de barras -->
    <div class="contenedor-graficos">
      <div class="card-grafico">
        <h4 class="titulo-grafico">Software instalado por fabricante</h4>
        <canvas id="graficoBarras"></canvas>
      </div>
    </div>
  </div>
  
  
  <app-alerta-personalizada [visible]="mostrarAlerta" [tipo]="tipoAlerta" [mensaje]="mensajeAlerta"
    (aceptar)="cerrarNotificacion()" (cancelar)="cerrarNotificacion()"></app-alerta-personalizada>
</div>